---
import Layout from "../../layouts/Layout.astro";
import Header from "../../components/Header.jsx";
import Footer from "../../components/Footer.jsx";
import { events } from "../../data/events.js";

export async function getStaticPaths() {
    return events.map((event) => ({
        params: { slug: event.slug },
        props: { event },
    }));
}

const { event } = Astro.props;

// Función simple para formatear el texto enriquecido de fullDescription
// Convertimos saltos de línea en <br/> o párrafos
const formattedDescription = event.fullDescription
    ? event.fullDescription.split("\n").filter((line) => line.trim() !== "")
    : [];
---

<Layout title={`${event.title} - Medicina Universal`}>
    <Header client:load />

    <main class="bg-[#0e2a29] min-h-screen text-white pt-64 pb-20">
        {/* Hero del Evento */}
        <section class="max-w-7xl mx-auto px-6">
            <a
                href={`${import.meta.env.BASE_URL}eventos`}
                class="inline-flex items-center text-secondary mb-8 hover:text-white transition-colors"
            >
                <svg
                    class="w-5 h-5 mr-2"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                >
                    <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                </svg>
                Volver a Eventos
            </a>

            <div
                class="relative rounded-3xl overflow-hidden h-[400px] md:h-[500px] mb-12 shadow-2xl"
            >
                <img
                    src={`${import.meta.env.BASE_URL}images/gallery/${event.image}`}
                    alt={event.title}
                    class="w-full h-full object-cover"
                />
                <div
                    class="absolute inset-0 bg-gradient-to-t from-[#0e2a29] via-transparent to-transparent"
                >
                </div>

                <div class="absolute bottom-0 left-0 p-8 md:p-12 w-full">
                    <span
                        class="bg-secondary text-primary px-4 py-1 rounded-full text-sm font-bold uppercase tracking-wider mb-4 inline-block"
                    >
                        {event.category}
                    </span>
                    <h1
                        class="text-4xl md:text-6xl font-serif font-bold mb-4 leading-tight"
                    >
                        {event.title}
                    </h1>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                {/* Columna 1: Descripción */}
                <div class="space-y-8">
                    <div
                        class="prose prose-invert prose-lg max-w-none text-gray-300"
                    >
                        <p
                            class="text-xl font-light leading-relaxed text-white border-l-4 border-secondary pl-6 italic"
                        >
                            {event.description}
                        </p>

                        <div class="mt-8 space-y-4">
                            {
                                formattedDescription.map((paragraph) => (
                                    <p
                                        set:html={paragraph.replace(
                                            /\*\*(.*?)\*\*/g,
                                            '<strong class="text-white">$1</strong>',
                                        )}
                                    />
                                ))
                            }
                        </div>
                    </div>
                </div>

                {/* Columna 2: Detalles (Sin botón) */}
                <div>
                    <div
                        class="bg-white/5 border border-white/10 p-8 rounded-3xl sticky top-32"
                    >
                        <h3
                            class="text-xl font-serif text-white mb-6 border-b border-white/10 pb-4"
                        >
                            Detalles
                        </h3>

                        <ul class="space-y-6">
                            <li class="flex items-start">
                                <span
                                    class="bg-white/10 p-2 rounded-lg mr-4 text-secondary"
                                >
                                    <svg
                                        class="w-6 h-6"
                                        fill="none"
                                        stroke="currentColor"
                                        viewBox="0 0 24 24"
                                        ><path
                                            stroke-linecap="round"
                                            stroke-linejoin="round"
                                            stroke-width="2"
                                            d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
                                        ></path></svg
                                    >
                                </span>
                                <div>
                                    <strong
                                        class="block text-white text-sm uppercase tracking-wide"
                                        >Fecha</strong
                                    >
                                    <span class="text-gray-300"
                                        >{event.date}</span
                                    >
                                </div>
                            </li>
                            <li class="flex items-start">
                                <span
                                    class="bg-white/10 p-2 rounded-lg mr-4 text-secondary"
                                >
                                    <svg
                                        class="w-6 h-6"
                                        fill="none"
                                        stroke="currentColor"
                                        viewBox="0 0 24 24"
                                        ><path
                                            stroke-linecap="round"
                                            stroke-linejoin="round"
                                            stroke-width="2"
                                            d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
                                        ></path></svg
                                    >
                                </span>
                                <div>
                                    <strong
                                        class="block text-white text-sm uppercase tracking-wide"
                                        >Hora</strong
                                    >
                                    <span class="text-gray-300"
                                        >{event.time}</span
                                    >
                                </div>
                            </li>
                            <li class="flex items-start">
                                <span
                                    class="bg-white/10 p-2 rounded-lg mr-4 text-secondary"
                                >
                                    <svg
                                        class="w-6 h-6"
                                        fill="none"
                                        stroke="currentColor"
                                        viewBox="0 0 24 24"
                                        ><path
                                            stroke-linecap="round"
                                            stroke-linejoin="round"
                                            stroke-width="2"
                                            d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
                                        ></path><path
                                            stroke-linecap="round"
                                            stroke-linejoin="round"
                                            stroke-width="2"
                                            d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"
                                        ></path></svg
                                    >
                                </span>
                                <div>
                                    <strong
                                        class="block text-white text-sm uppercase tracking-wide"
                                        >Ubicación</strong
                                    >
                                    <span class="text-gray-300"
                                        >{event.location}</span
                                    >
                                </div>
                            </li>
                            <li class="flex items-start">
                                <span
                                    class="bg-white/10 p-2 rounded-lg mr-4 text-secondary"
                                >
                                    <svg
                                        class="w-6 h-6"
                                        fill="none"
                                        stroke="currentColor"
                                        viewBox="0 0 24 24"
                                        ><path
                                            stroke-linecap="round"
                                            stroke-linejoin="round"
                                            stroke-width="2"
                                            d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                                        ></path></svg
                                    >
                                </span>
                                <div>
                                    <strong
                                        class="block text-white text-sm uppercase tracking-wide"
                                        >Inversión</strong
                                    >
                                    <span
                                        class="text-gray-300 text-lg font-bold"
                                        >{event.price}</span
                                    >
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>

                {/* Columna 3: Formulario de Reserva */}
                <div>
                    <div
                        class="bg-secondary/10 border border-secondary/30 p-8 rounded-3xl sticky top-32"
                    >
                        <h3 class="text-xl font-serif text-white mb-2">
                            Reserva tu Cupo
                        </h3>
                        <p class="text-gray-400 text-sm mb-6">
                            Diligencia tus datos para iniciar el proceso de
                            inscripción.
                        </p>

                        <form id="reservationForm" class="space-y-4">
                            <div>
                                <label
                                    for="name"
                                    class="block text-xs uppercase tracking-wider text-gray-400 mb-1"
                                    >Nombre Completo</label
                                >
                                <input
                                    type="text"
                                    id="name"
                                    name="name"
                                    required
                                    class="w-full bg-white/5 border border-white/10 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-secondary transition-colors"
                                    placeholder="Tu nombre"
                                />
                            </div>
                            <div>
                                <label
                                    for="phone"
                                    class="block text-xs uppercase tracking-wider text-gray-400 mb-1"
                                    >WhatsApp / Teléfono</label
                                >
                                <input
                                    type="tel"
                                    id="phone"
                                    name="phone"
                                    required
                                    class="w-full bg-white/5 border border-white/10 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-secondary transition-colors"
                                    placeholder="+57 300 000 0000"
                                />
                            </div>
                            <div>
                                <label
                                    for="email"
                                    class="block text-xs uppercase tracking-wider text-gray-400 mb-1"
                                    >Correo Electrónico</label
                                >
                                <input
                                    type="email"
                                    id="email"
                                    name="email"
                                    class="w-full bg-white/5 border border-white/10 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-secondary transition-colors"
                                    placeholder="tucorreo@ejemplo.com"
                                />
                            </div>

                            <button
                                type="submit"
                                class="w-full bg-secondary hover:bg-white text-primary font-bold py-3 rounded-xl transition-all shadow-lg hover:scale-105 mt-4 cursor-pointer"
                            >
                                Confirmar Reserva
                            </button>
                            <p class="text-center text-xs text-gray-500 mt-2">
                                Serás redirigido a WhatsApp para finalizar.
                            </p>
                        </form>
                    </div>
                </div>
            </div>
        </section>
    </main>
    <Footer client:load />
</Layout>

<script define:vars={{ eventTitle: event.title }}>
    const form = document.getElementById("reservationForm");

    if (form) {
        form.addEventListener("submit", (e) => {
            e.preventDefault();
            const formData = new FormData(form);
            const name = formData.get("name");
            const phone = formData.get("phone");
            const email = formData.get("email");

            const message = `Hola, quiero reservar cupo para *${eventTitle}*.\n\nMis datos son:\nNombre: ${name}\nTeléfono: ${phone}\nEmail: ${email}`;
            const whatsappUrl = `https://wa.me/573000000000?text=${encodeURIComponent(message)}`;

            window.open(whatsappUrl, "_blank");
        });
    }
</script>
